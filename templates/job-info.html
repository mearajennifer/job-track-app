{% extends 'base.html' %}

{% block content %}

<div class="container">

  <div class="row">
    <!-- JOB TITLE HEADER -->
    <div class="col-8">
      <h5>{{ job.title }}</h5>
    </div>
    <!-- DROP DOWN STATUS MENU -->
    <div class="col-2">
      <div class="dropdown">
        <form action="/dashboard/job-status" method="POST">

          <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{ job_status[0].job_codes.description }}
          </button>

          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <input type="hidden" name="job_id" value="{{ job.job_id }}">

            <button class="dropdown-item submit" type="submit" name="job_code" value="1">
              Interested
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="2">
              Applied
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="3">
              Phone interview
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="4">
              On-site interview
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="5">
              Received offer
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="6">
              Accepted offer
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="7">
              Declined offer
            </button>

            <button class="dropdown-item submit" type="submit" name="job_code" value="8">
              No job offer
            </button>
          
          </div>

        </form>
      </div>
    </div>
    <!-- END DROP DOWN -->
  </div>

  <!-- COMPANY NAME -->
  <div class="row">
    <a href="/dashboard/companies/{{ job.company_id }}">{{ job.companies.name }}</a>
  </div>

  {% if edit == "edits-on" %}
    <!-- EDIT MODE -->
    <form action="/dashboard/jobs/{{ job.job_id }}" method="POST">

      <div class="form-group">
        <label>Job posting: </label>
        <input type="text" class="form-control" name="link" value="{{ job.link }}">
      </div>

      <div class="form-group">
        <label>Average salary: </label>
        <input type="text" class="form-control" name="avg_salary" value="{{ job.avg_salary }}">
      </div

      <div class="form-group">
        <label>Notes: </label></p>
        <textarea class="form-control" rows="3" name="notes">{{ job.notes }}</textarea>
      </div>

      <div class="row">
        <button type="button submit" class="btn btn-secondary btn-sm" name="edit" value="edits-off">submit</button>
      </div>

    </form>
  </div>

  {% else %}
    <!-- STATIC MODE -->

    <!-- JOB TITLE -->
    <div class="row">
      Job posting: <a href="{{ job.link }}">{{ job.link }}</a>
    </div>

    <div class="row">
      {% if job.avg_salary %}

        <!-- SALARY ALREADY SELECTED -->
        Average salary: {{ job.avg_salary }}

      {% else %}

        <!-- FORM TO SELECT SALARY -->
        <form action="/dashboard/jobs/salary" method="POST">
          <div class="form-group">
            <label>Find average salary</label>

              <!-- SALARY METRO AREA SELECTION -->
              <select class="form-control" name="metro">
                <option selected>Metro area</option>
                {% for metro in metros %}
                  <option value="{{ metro[0] }}">{{ metro[0] }}</option>
                {% endfor %}
              </select>

              <!-- SALARY JOB TITLE SELECTION -->
              <select class="form-control" name="job_title">
                <option selected>Job title</option>
                {% for job_title in job_titles %}
                  <option value="{{ job_title[0] }}">{{ job_title[0] }}</option>
                {% endfor %}
              </select>

              <input type="hidden" name="job_id" value="{{ job.job_id }}">
            <button type="button submit" class="btn btn-secondary btn-sm">submit</button>
          </div>
        </form>
      {% endif %}
    </div>

    <!-- NOTES -->
    <div class="row">
      <p><label>Notes: </label></p>
      {% if job.notes == None %}
        <p>--</p>
      {% else %}
        <p>{{ job.notes }}</p>
      {% endif %}
    </div>

    <!-- EDIT BUTTON -->
    <div class="row">
      <form action="/dashboard/jobs/{{ job.job_id }}" method="GET">
        <button type="button submit" class="btn btn-secondary btn-sm" name="edit" value="edits-on">edit</button>
      </form>
    </div>

  </div>
  <br>

  <!-- EVENTS -->
  <div class="container" align="center">

    <!-- HEADER -->
    <div class="row">
      <div class="col-2" align="center"><h5>Date</h5></div>
      <div class="col-2" align="center"><h5>Status</h5></div>
    </div>
    <div><hr></div>

    <!-- LOOP THROUGH STATUS LIST -->
    {% for status in job_status %}
      <div class="row">

        <!-- DATE -->
        <div class="col-2" align="center">
          {{ status.date_created }}
        </div>

        <!-- STATUS -->
        <div class="col-2" align="center">
          {{ status.job_codes.description }}
        </div>

      </div>
    {% endfor %}

  </div>

  {% endif %}

{% endblock %}








































