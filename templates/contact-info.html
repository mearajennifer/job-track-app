{% extends 'base.html' %}

{% block content %}
 

<div class="container">

  {% if edit == "edits-on" %}

    <!-- EDIT MODE -->
    <form action="/dashboard/contacts/{{ contact.contact_id }}" method="POST">

      <div class="form-group">
        <label>First name:</label>
        <input type="text" class="form-control" name="fname" value="{{ contact.fname }}" required />
      </div>

      <div class="form-group">
        <label>Last name:</label>
        <input type="text" class="form-control" name="lname" value="{{ contact.lname }}" required />
      </div>

      <div class="form-group">
        <label>Email:</label>
        <input type="email" class="form-control" name="email" value="{{ contact.email if contact.email != None else "" }}">
      </div>

      <div class="form-group">
        <label>Phone:</label>
        <input type="phone" class="form-control" name="phone" value="{{ contact.phone if contact.phone != None else "" }}" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}">
      </div>

      <!-- COMPANY -->
      <div class="form-group">
        <label class="control-label">Company:</label>

          <!-- SELECT MENU -->
          <select class="form-control" name="company_id">
            <option selected value>Select existing company</option>
            {% for company in companies %}
              <option value="{{ company.company_id }}" >{{ company.name }}</option>
            {% endfor %}  
          </select><br>

          <!-- TEXT INPUT -->
          <input type="text" class="form-control" name="company_name" value="{{ contact.companies.name }}">
      </div>

      <div class="form-group">
        <label>Notes:</label>
        <textarea class="form-control" rows="3" name="notes">{{ contact.notes if contact.notes != None else ""}}</textarea>
      </div>

      <div class="row">
        <button type="button submit" class="btn btn-secondary btn-sm" name="edit" value="edits-off">submit</button>
      </div>

    </form>
  </div>

  {% else %}

    <!-- STATIC MODE -->
    <div class="row">

      <!-- CONTACT NAME -->
      <div class="col-8">
        <h5>{{ contact.fname }} {{ contact.lname }}</h5>
      </div>

      <!-- CONTACT EVENTS -->
      <div class="col-2">
        <div class="dropdown">
          <form action="/dashboard/contact-status" method="POST">

            <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              {{ contact_events[0].contact_codes.description }}
            </button>

            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <input type="hidden" name="contact_id" value="{{ contact.contact_id }}">
              <button class="dropdown-item submit" type="submit" name="contact_code" value="1">
                Met at networking event
              </button>

              <button class="dropdown-item submit" type="submit" name="contact_code" value="2">
                Requested informational interview
              </button>

              <button class="dropdown-item submit" type="submit" name="contact_code" value="3">
                Met for informational interview
              </button>

              <button class="dropdown-item submit" type="submit" name="contact_code" value="4">
                Introduced to new contacts
              </button>

              <button class="dropdown-item submit" type="submit" name="contact_code" value="5">
                Referred for job application
              </button>
            </div>

          </form>
        </div>
      </div>

    </div>

    <div class="row">Email:
        <a href="mailto:{{ contact.email if contact.email != None else "" }}">{{ contact.email if contact.email != None else "" }}</a>
    </div>

    <div class="row">Phone:
      {% if contact.phone != None %}
        {{ contact.phone[:3] }}-{{ contact.phone[3:6] }}-{{ contact.phone[6:] }}
      {% else %}
      {% endif %}
    </div>

    <div class="row">Company: 
      <a href="/dashboard/companies/{{ contact.company_id }}">
        {{ contact.companies.name }}</a>
    </div>

    <div class="row">Notes:
      {{ contact.notes if contact.notes != None else "" }}
    </div>

    <div class="row">
      <form action="/dashboard/contacts/{{ contact.contact_id }}" method="GET">
        <button type="button submit" class="btn btn-secondary btn-sm" name="edit" value="edits-on">edit</button>
      </form>
    </div>

  </div>
  <br>

  <!-- EVENTS -->
  <table>

    <!-- HEADER -->
    <th>
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Action</th>
      </tr>
    </th>

    <tbody>
      <!-- LOOP THROUGH STATUS LIST -->
      {% for event in contact_events %}
        <tr>

          <!-- DATE -->
          <td>
            {{ event.date_created.strftime('%B %-d, %Y') }}
          </td>

          <!-- STATUS -->
          <td>
            {{ event.contact_codes.description }}
          </td>

        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% endif %}


{% endblock %}
